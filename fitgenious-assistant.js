// =============================================
// FITGENIOUS AI ASSISTANT - Expert System
// =============================================

class FitGeniousAssistant {
    constructor() {
        this.name = "FitGenious AI Assistant";
        this.version = "2.0";
        this.expertise = "Marketing Digital para Coaches de Fitness";
        this.init();
    }

    init() {
        console.log(`üß† ${this.name} v${this.version} inicializado`);
        this.loadKnowledgeBase();
        this.loadResponseTemplates();
        this.loadPersonalityMatrix();
    }

    // ========================
    // BASE DE CONHECIMENTO COMPLETA
    // ========================
    loadKnowledgeBase() {
        this.knowledge = {
            // INFORMACOES DA EMPRESA
            company: {
                name: "FitGenious",
                founder: "Guilherme Ferreira",
                founded: "2024",
                mission: "Transformar coaches de fitness em criadores de conte√∫do de alto desempenho",
                vision: "Ser a principal refer√™ncia em marketing digital para o mercado fitness global",
                values: ["Excel√™ncia", "Resultados", "Inova√ß√£o", "Parceria", "Transpar√™ncia"]
            },

            // SERVICOS DETALHADOS
            services: {
                premium: {
                    name: "Servi√ßo Premium Completo",
                    description: "Gest√£o 360¬∞ do marketing digital do coach",
                    includes: [
                        "Estrat√©gia de conte√∫do personalizada",
                        "Produ√ß√£o de 30-40 v√≠deos mensais",
                        "Edi√ß√£o profissional com motion graphics",
                        "Gest√£o de todas as redes sociais",
                        "Copywriting persuasivo",
                        "Otimiza√ß√£o para algoritmos",
                        "Relat√≥rios de performance semanais",
                        "Consultoria estrat√©gica semanal",
                        "Suporte priorit√°rio",
                        "Acesso √† comunidade exclusiva"
                    ],
                    platforms: ["Instagram", "TikTok", "YouTube", "LinkedIn", "Twitter"],
                    results: "3-5 clientes premium por semana"
                },

                editing: {
                    name: "Pacote Edi√ß√£o Avan√ßada",
                    description: "Foco em edi√ß√£o de v√≠deos de alta convers√£o",
                    includes: [
                        "Edi√ß√£o estilo 'Alpha Male'",
                        "Motion graphics personalizadas",
                        "Sound design profissional",
                        "Color grading cinematogr√°fico",
                        "Legendas din√¢micas",
                        "Thumbnails click√°veis",
                        "Formata√ß√£o multi-plataforma"
                    ],
                    turnaround: "12-24 horas"
                },

                strategy: {
                    name: "Consultoria Estrat√©gica",
                    description: "Mentoria 1:1 para coaches experientes",
                    includes: [
                        "An√°lise de mercado completa",
                        "Posicionamento de marca",
                        "Estrat√©gia de precifica√ß√£o",
                        "Funnel de vendas otimizado",
                        "Scripts de vendas",
                        "Gest√£o de obje√ß√µes",
                        "Upselling estrat√©gico"
                    ]
                }
            },

            // METODOLOGIA PROPRIETARIA
            methodology: {
                framework: "M.E.D.S. Framework‚Ñ¢",
                phases: {
                    phase1: {
                        name: "Mapeamento",
                        duration: "3-5 dias",
                        activities: [
                            "An√°lise de perfil completo",
                            "Identifica√ß√£o de buyer personas",
                            "Pesquisa de concorr√™ncia",
                            "Defini√ß√£o de posicionamento √∫nico",
                            "An√°lise de mercado"
                        ]
                    },
                    phase2: {
                        name: "Estrat√©gia",
                        duration: "2-3 dias",
                        activities: [
                            "Plano de conte√∫do mensal",
                            "Cronograma de publica√ß√µes",
                            "Estrat√©gia de plataformas",
                            "Defini√ß√£o de tom e voz",
                            "Plano de engajamento"
                        ]
                    },
                    phase3: {
                        name: "Desenvolvimento",
                        duration: "Cont√≠nuo",
                        activities: [
                            "Produ√ß√£o de conte√∫do",
                            "Edi√ß√£o profissional",
                            "Otimiza√ß√£o t√©cnica",
                            "Publica√ß√£o estrat√©gica",
                            "Gest√£o de comunidade"
                        ]
                    },
                    phase4: {
                        name: "Scalability",
                        duration: "Cont√≠nuo",
                        activities: [
                            "An√°lise de performance",
                            "Otimiza√ß√£o de resultados",
                            "Escalabilidade de processos",
                            "Expans√£o de alcance",
                            "Automa√ß√£o inteligente"
                        ]
                    }
                }
            },

            // RESULTADOS COMPROVADOS
            results: {
                metrics: {
                    clientAcquisition: "3-5 clientes premium/semana",
                    engagement: "300-500% de aumento",
                    growth: "1.000-5.000 seguidores/m√™s",
                    roi: "5-10x em 3 meses",
                    satisfaction: "98% de taxa de satisfa√ß√£o"
                },
                caseStudies: [
                    {
                        coach: "Carlos Silva - Personal Trainer",
                        before: "2 clientes/m√™s, R$ 3.000/m√™s",
                        after: "15 clientes/m√™s, R$ 22.000/m√™s",
                        timeline: "45 dias"
                    },
                    {
                        coach: "Ana Santos - Coach Online",
                        before: "Instagram 2k, 0 clientes online",
                        after: "Instagram 18k, 12 clientes premium",
                        timeline: "60 dias"
                    },
                    {
                        coach: "Miguel Costa - Especialista em Emagrecimento",
                        before: "Depend√™ncia de indica√ß√µes",
                        after: "Funnel automatizado, 8 vendas/semana",
                        timeline: "30 dias"
                    }
                ],
                guarantee: {
                    type: "Garantia 100% Money-Back",
                    terms: "Se n√£o adquirir pelo menos 3 clientes premium no primeiro m√™s",
                    process: "Devolu√ß√£o integral sem burocracia"
                }
            },

            // INVESTIMENTO E CONDI√á√ïES
            pricing: {
                models: {
                    premium: {
                        name: "Plano Premium Completo",
                        investment: "Personalizado por resultados",
                        payment: "Flex√≠vel (mensal/trimestral)",
                        commitment: "M√≠nimo 3 meses recomendado",
                        includes: "Todos os servi√ßos premium"
                    },
                    editing: {
                        name: "Pacote Edi√ß√£o",
                        investment: "Valor fixo mensal",
                        includes: "Apenas servi√ßos de edi√ß√£o"
                    }
                },
                vacancies: {
                    current: 3,
                    monthly: 5,
                    waitlist: 12,
                    selection: "Processo seletivo rigoroso"
                }
            },

            // DIFERENCIAIS EXCLUSIVOS
            differentials: {
                technology: [
                    "Sistema propriet√°rio de an√°lise de conte√∫do",
                    "IA para otimiza√ß√£o de algoritmos",
                    "Dashboard personalizado de resultados",
                    "Ferramentas exclusivas de edi√ß√£o"
                ],
                expertise: [
                    "Especializa√ß√£o exclusiva em fitness",
                    "Equipe com background em educa√ß√£o f√≠sica",
                    "Conhecimento profundo do buyer persona",
                    "Cases internacionais comprovados"
                ],
                approach: [
                    "Metodologia M.E.D.S. Framework‚Ñ¢",
                    "Abordagem cient√≠fica de engajamento",
                    "Otimiza√ß√£o baseada em dados reais",
                    "Estrat√©gias testadas A/B"
                ]
            },

            // PERGUNTAS T√âCNICAS DETALHADAS
            technical: {
                content: {
                    types: ["Educativo", "Entretenimento", "Inspiracional", "Vendas", "Testemunho"],
                    formats: ["Reels/TikToks", "Posts carrossel", "Stories", "V√≠deos longos", "Lives"],
                    frequency: "1-2 posts principais + 5-7 stories di√°rios"
                },
                platforms: {
                    instagram: "Foco em Reels e Stories",
                    tiktok: "Conte√∫do viral e entretenimento",
                    youtube: "Conte√∫do educativo aprofundado",
                    linkedin: "Posicionamento profissional"
                },
                equipment: {
                    basic: "Smartphone + ilumina√ß√£o natural",
                    recommended: "Microfone lavalier + ring light",
                    professional: "C√¢mera DSLR + est√∫dio caseiro"
                },
                time: {
                    client: "2-3 horas/semana (grava√ß√µes + calls)",
                    team: "15-20 horas/semana por cliente"
                }
            }
        };
    }

    // ========================
    // SISTEMA DE PERSONALIDADE
    // ========================
    loadPersonalityMatrix() {
        this.personality = {
            tone: "Profissional, Confiante e Motivacional",
            traits: [
                "Especialista em fitness marketing",
                "Direto ao ponto mas acolhedor",
                "Focado em resultados mensur√°veis",
                "Paix√£o por transformar vidas",
                "Comunicador claro e persuasivo"
            ],
            communication: {
                greeting: "Entusi√°stico mas profissional",
                explanation: "Detalhado mas n√£o t√©cnico demais",
                persuasion: "Baseado em dados e cases",
                urgency: "Genu√≠no e n√£o agressivo",
                closing: "Sempre com call-to-action claro"
            }
        };
    }

    // ========================
    // TEMPLATES DE RESPOSTA AVAN√áADOS
    // ========================
    loadResponseTemplates() {
        this.templates = {
            greeting: () => {
                const greetings = [
                    `üëã Ol√°! Sou o ${this.name}, especialista em marketing digital para coaches de fitness. Com ${this.knowledge.results.caseStudies.length} cases comprovados, estou aqui para transformar seu neg√≥cio! Como posso ajud√°-lo hoje?`,
                    `üí™ Boas-vindas! ${this.name} √† sua disposi√ß√£o. Especialista em escalar neg√≥cios de fitness atrav√©s de conte√∫do estrat√©gico. Em que posso ser √∫til?`,
                    `üöÄ Prazer! ${this.name} aqui. J√° ajudei ${this.knowledge.results.caseStudies.length} coaches a multiplicarem seus resultados. Qual sua d√∫vida sobre marketing digital para fitness?`
                ];
                return this.randomChoice(greetings);
            },

            services: (context) => {
                const service = this.knowledge.services.premium;
                return `üéØ ${service.name}

${service.description} focado em ${service.results}.

üì¶ INCLUI:
${service.includes.slice(0, 5).map(item => `‚Ä¢ ${item}`).join('\n')}

üé¨ PLATAFORMAS: ${service.platforms.join(', ')}

${context ? `üí° Para ${context}, adaptamos especialmente: ${this.getCustomApproach(context)}` : ''}

üìû Pronto para detalhes espec√≠ficos?`;
            },

            methodology: () => {
                const method = this.knowledge.methodology;
                return `üî¨ ${method.framework} - Nossa Metodologia Comprovada:

${Object.values(method.phases).map(phase => 
    `üìã ${phase.name} (${phase.duration}):
${phase.activities.map(act => `   ‚ó¶ ${act}`).join('\n')}`
).join('\n\n')}

‚ö° Resultado: ${this.knowledge.results.metrics.clientAcquisition}`;
            },

            results: (specific) => {
                const cases = this.knowledge.results.caseStudies;
                const randomCase = this.randomChoice(cases);
                
                return `üìä RESULTADOS COMPROVADOS:

‚úÖ ${this.knowledge.results.metrics.clientAcquisition}
‚úÖ ${this.knowledge.results.metrics.engagement}
‚úÖ ${this.knowledge.results.metrics.roi}

üèÜ CASE REAL:
"${randomCase.coach}"
ANTES: ${randomCase.before}
DEPOIS: ${randomCase.after}
TEMPO: ${randomCase.timeline}

${this.knowledge.results.guarantee.type}: ${this.knowledge.results.guarantee.terms}`;
            },

            pricing: (budgetContext) => {
                const pricing = this.knowledge.pricing;
                return `üíé INVESTIMENTO:

${pricing.models.premium.name}
üíµ ${pricing.models.premium.investment}
üìÖ ${pricing.models.premium.payment}
‚è±Ô∏è ${pricing.models.premium.commitment}

üéØ VAGAS DISPON√çVEIS: ${pricing.vacancies.current} de ${pricing.vacancies.monthly}

${budgetContext ? `üí° ${this.getBudgetResponse(budgetContext)}` : 'üìû Valores personalizados baseados em seu potencial de resultados!'}`;
            },

            differentials: () => {
                const diff = this.knowledge.differentials;
                return `‚≠ê DIFERENCIAIS FITGENIOUS:

ü§ñ TECNOLOGIA:
${diff.technology.slice(0, 2).map(item => `‚Ä¢ ${item}`).join('\n')}

üéØ EXPERTISE:
${diff.expertise.slice(0, 2).map(item => `‚Ä¢ ${item}`).join('\n')}

üöÄ ABORDAGEM:
${diff.approach.slice(0, 2).map(item => `‚Ä¢ ${item}`).join('\n')}

üí° Resultado: Estrat√©gia 100% personalizada para coaches de fitness!`;
            }
        };
    }

    // ========================
    // SISTEMA DE AN√ÅLISE INTELIGENTE
    // ========================
    analyzeMessage(message) {
        const analysis = {
            intent: this.detectIntent(message),
            context: this.detectContext(message),
            sentiment: this.detectSentiment(message),
            urgency: this.detectUrgency(message),
            userType: this.detectUserType(message),
            objections: this.detectObjections(message),
            name: this.extractName(message),
            budgetMention: this.detectBudgetMention(message)
        };

        return analysis;
    }

    detectIntent(message) {
        const msg = message.toLowerCase();
        
        const intents = {
            greeting: ['oi', 'ol√°', 'ola', 'hey', 'hi', 'hello', 'bom dia', 'boa tarde', 'boa noite'],
            services: ['servi√ßo', 'oferta', 'fazem', 'proposta', 'trabalham', 'entrega', 'o que voc√™s fazem'],
            methodology: ['como funciona', 'metodologia', 'processo', 'abordagem', 'm√©todo', 'sistema'],
            results: ['resultado', 'garantia', 'funciona', 'prova', 'caso', 'compensador', 'retorno'],
            pricing: ['pre√ßo', 'valor', 'investimento', 'custo', 'quanto custa', 'pagamento'],
            differentials: ['diferente', 'diferencial', '√∫nico', 'vantagem', 'por que voc√™s'],
            technical: ['como gravar', 'equipamento', 'tempo', 'horas', 'plataforma', 'instagram', 'tiktok'],
            urgency: ['vagas', 'disponibilidade', 'espera', 'lista', 'quando', 'urgente'],
            cta: ['agendar', 'call', 'reuni√£o', 'conversa', 'contato', 'whatsapp', 'falar', 'quero']
        };

        for (const [intent, keywords] of Object.entries(intents)) {
            if (keywords.some(keyword => msg.includes(keyword))) {
                return intent;
            }
        }

        return 'general';
    }

    detectContext(message) {
        const msg = message.toLowerCase();
        const contexts = {
            'personal trainer': ['personal trainer', 'personal', 'academia', 'presencial'],
            'coach online': ['online', 'digital', 'remoto', 'ecommerce'],
            'iniciante': ['iniciante', 'come√ßando', 'novo', 'primeira vez'],
            'experiente': ['experiente', 'j√° tenho', 'atualmente', 'h√° anos'],
            'especialista': ['especialista', 'expert', 'avan√ßado', 'j√° estabelecido']
        };

        for (const [context, keywords] of Object.entries(contexts)) {
            if (keywords.some(keyword => msg.includes(keyword))) {
                return context;
            }
        }

        return null;
    }

    detectSentiment(message) {
        const positive = ['quero', 'interessado', 'legal', 'bom', '√≥timo', 'excelente', 'perfeito'];
        const negative = ['caro', 'dif√≠cil', 'complexo', 'n√£o sei', 'talvez', 'depois'];
        const curious = ['como', 'porque', 'por que', 'pode explicar', 'entender'];

        const msg = message.toLowerCase();
        
        if (positive.some(word => msg.includes(word))) return 'positive';
        if (negative.some(word => msg.includes(word))) return 'negative';
        if (curious.some(word => msg.includes(word))) return 'curious';
        
        return 'neutral';
    }

    detectUrgency(message) {
        const urgentWords = ['urgente', 'r√°pido', 'logo', 'imediatamente', 'agora', 'hoje', 'j√°'];
        return urgentWords.some(word => message.toLowerCase().includes(word));
    }

    detectUserType(message) {
        const msg = message.toLowerCase();
        if (msg.includes('personal trainer')) return 'personal_trainer';
        if (msg.includes('online')) return 'online_coach';
        if (msg.includes('iniciante')) return 'beginner';
        if (msg.includes('experiente')) return 'experienced';
        return 'unknown';
    }

    detectObjections(message) {
        const msg = message.toLowerCase();
        const objections = [];
        
        if (msg.includes('caro') || msg.includes('cust')) objections.push('price');
        if (msg.includes('tempo') || msg.includes('ocupado')) objections.push('time');
        if (msg.includes('n√£o funciona') || msg.includes('j√° tentei')) objections.push('efficacy');
        if (msg.includes('complexo') || msg.includes('dif√≠cil')) objections.push('complexity');
        
        return objections;
    }

    detectBudgetMention(message) {
        const budgetWords = ['caro', 'barato', 'econ√¥mico', 'investir', 'dinheiro', 'or√ßamento', 'valor'];
        return budgetWords.some(word => message.toLowerCase().includes(word));
    }

    extractName(message) {
        const patterns = [
            /me chamo (\w+)/i,
            /sou (\w+)/i,
            /aqui √© (\w+)/i,
            /nome √© (\w+)/i,
            /pode me chamar de (\w+)/i
        ];
        
        for (const pattern of patterns) {
            const match = message.match(pattern);
            if (match) return match[1];
        }
        
        return null;
    }

    // ========================
    // GERADOR DE RESPOSTAS PRINCIPAIS
    // ========================
    async generateResponse(userMessage) {
        try {
            const analysis = this.analyzeMessage(userMessage);
            console.log('üîç An√°lise da mensagem:', analysis);

            let response;

            // Respostas baseadas na inten√ß√£o principal
            switch (analysis.intent) {
                case 'greeting':
                    response = this.templates.greeting();
                    break;

                case 'services':
                    response = this.templates.services(analysis.context);
                    break;

                case 'methodology':
                    response = this.templates.methodology();
                    break;

                case 'results':
                    response = this.templates.results();
                    break;

                case 'pricing':
                    response = this.templates.pricing(analysis.budgetMention);
                    break;

                case 'differentials':
                    response = this.templates.differentials();
                    break;

                case 'technical':
                    response = this.generateTechnicalResponse(userMessage, analysis);
                    break;

                case 'urgency':
                    response = this.generateUrgencyResponse(analysis);
                    break;

                case 'cta':
                    response = this.generateCTAResponse(userMessage, analysis);
                    break;

                default:
                    response = this.generateSmartResponse(userMessage, analysis);
            }

            // Aplica camadas de personaliza√ß√£o
            response = this.applyPersonalization(response, analysis);
            response = this.applySentimentAdjustment(response, analysis);
            response = this.applyUrgencyLayer(response, analysis);
            response = this.applyObjectionHandling(response, analysis);

            return response;

        } catch (error) {
            console.error('Erro ao gerar resposta:', error);
            return this.getFallbackResponse();
        }
    }

    // ========================
    // RESPOSTAS ESPECIALIZADAS
    // ========================
    generateTechnicalResponse(message, analysis) {
        const msg = message.toLowerCase();
        
        if (msg.includes('equipamento') || msg.includes('c√¢mera') || msg.includes('celular')) {
            return `üé• EQUIPAMENTO IDEAL:

üì± B√ÅSICO (Excelente para come√ßar):
‚Ä¢ Smartphone com c√¢mera 12MP+
‚Ä¢ Ilumina√ß√£o natural (janela)
‚Ä¢ √Åudio do celular em ambiente quieto

üíé RECOMENDADO (Qualidade profissional):
‚Ä¢ Microfone lavalier (R$ 100-200)
‚Ä¢ Ring light ou luz LED
‚Ä¢ Trip√© simples
‚Ä¢ App de grava√ß√£o (FilmoraGo)

üé¨ PROFISSIONAL (Est√∫dio caseiro):
‚Ä¢ C√¢mera DSLR ou espelho
‚Ä¢ Microfone shotgun
‚Ä¢ Ilumina√ß√£o 3-point
‚Ä¢ Green screen opcional

üí° Dica: Comece com o b√°sico! O conte√∫do √© mais importante que o equipamento.`;
        }

        if (msg.includes('tempo') || msg.includes('horas')) {
            return `‚è±Ô∏è INVESTIMENTO DE TEMPO:

üïí SEU TEMPO SEMANAL: 2-3 horas
‚Ä¢ 1-2 horas: Grava√ß√£o de conte√∫dos
‚Ä¢ 30-45min: Call estrat√©gica conosco
‚Ä¢ 15-30min: Revis√£o de resultados

üïí NOSSO TEMPO POR VOC√ä: 15-20 horas/semana
‚Ä¢ 5-7h: Estrat√©gia e planejamento
‚Ä¢ 8-10h: Edi√ß√£o e produ√ß√£o
‚Ä¢ 2-3h: Gest√£o e otimiza√ß√£o

‚ö° Resultado: Voc√™ foca no coaching, n√≥s fazemos o marketing!`;
        }

        if (msg.includes('instagram') || msg.includes('tiktok') || msg.includes('plataforma')) {
            return `üì± ESTRAT√âGIA POR PLATAFORMA:

üé≠ INSTAGRAM:
‚Ä¢ Reels di√°rios (0-30 segundos)
‚Ä¢ Stories 5-7x/dia
‚Ä¢ Posts carrossel 3x/semana
‚Ä¢ Foco: Autoridade e relacionamento

üéµ TIKTOK:
‚Ä¢ V√≠deos curtos e virais
‚Ä¢ Tend√™ncias e challenges
‚Ä¢ Foco: Alcance massivo e viralidade

üé• YOUTUBE:
‚Ä¢ Conte√∫do educativo aprofundado
‚Ä¢ V√≠deos longos (5-15 minutos)
‚Ä¢ Foco: SEO e audi√™ncia fiel

üíº LINKEDIN:
‚Ä¢ Posicionamento profissional
‚Ä¢ Conte√∫do corporativo
‚Ä¢ Foco: B2B e parcerias

üéØ Estrat√©gia integrada em todas as plataformas!`;
        }

        return this.generateSmartResponse(message, analysis);
    }

    generateUrgencyResponse(analysis) {
        const pricing = this.knowledge.pricing;
        
        return `üö® DISPONIBILIDADE ATUAL:

üéØ VAGAS DISPON√çVEIS: ${pricing.vacancies.current} de ${pricing.vacancies.monthly}
üìã LISTA DE ESPERA: ${pricing.vacancies.waitlist} coaches

‚ö° PROCESO SELETIVO:
1. Call de compatibilidade (30min)
2. An√°lise de perfil
3. Proposta personalizada
4. In√≠cio imediato

üíé Por que as vagas s√£o limitadas?
Para garantir excel√™ncia e resultados extraordin√°rios para cada coach!

${this.generateCTAResponse('', analysis)}`;
    }

    generateCTAResponse(message, analysis) {
        const preference = message.toLowerCase().includes('whatsapp') ? 'whatsapp' : 
                          message.toLowerCase().includes('call') ? 'call' : 'both';

        const ctas = {
            call: `üìÖ AGENDE SUA CALL ESTRAT√âGICA:
            
Calendly: https://calendly.com/fitgeniouscontent/30min

‚è∞ 30 minutos gratuitos
üéØ An√°lise do seu neg√≥cio
üí° Plano personalizado sugerido`,

            whatsapp: `üì± FALE DIRETO CONOSCO:
            
WhatsApp: +351963828378

üí¨ Resposta em 5-15 minutos
üìä Podemos analisar seu perfil
üéØ Tire todas suas d√∫vidas`,

            both: `üéØ VAMOS CONVERSAR!

üìÖ Calendly: https://calendly.com/fitgeniouscontent/30min
üì± WhatsApp: +351963828378

‚è∞ 30min gratuitos para analisarmos seu neg√≥cio
üí° Sem compromisso - apenas valor!`
        };

        return ctas[preference];
    }

    generateSmartResponse(message, analysis) {
        const smartResponses = [
            `üí° Interessante sua pergunta sobre "${message.substring(0, 40)}..."! 

Baseado em nossos ${this.knowledge.results.caseStudies.length} cases com coaches, posso explicar como isso se aplica ao marketing digital para fitness.

üéØ Gostaria de saber mais sobre:
‚Ä¢ Nossos servi√ßos e metodologia?
‚Ä¢ Resultados comprovados?
‚Ä¢ Investimento e condi√ß√µes?`,

            `üîç Excelente questionamento! "${message.substring(0, 35)}" √© crucial para o sucesso online.

Nossa experi√™ncia com coaches mostra que a abordagem correta aqui gera ${this.knowledge.results.metrics.clientAcquisition}.

üí™ Posso detalhar como trabalhamos isso no M.E.D.S. Framework‚Ñ¢?`,

            `üöÄ Boa pergunta! "${message.substring(0, 30)}" foi um divisor de √°guas para coaches como ${
                this.randomChoice(this.knowledge.results.caseStudies).coach.split(' - ')[0]
            }.

üìä Nossos dados mostram que isso impacta diretamente no ${this.knowledge.results.metrics.roi}.

Quer que eu aprofunde em algum aspecto espec√≠fico?`
        ];

        let response = this.randomChoice(smartResponses);

        // Adiciona camada de urg√™ncia se detectada
        if (analysis.urgency) {
            response += `\n\n${this.generateUrgencyResponse(analysis)}`;
        }

        return response;
    }

    // ========================
    // SISTEMA DE PERSONALIZA√á√ÉO
    // ========================
    applyPersonalization(response, analysis) {
        if (analysis.name) {
            response = response.replace(/Ol√°!/, `Ol√°, ${analysis.name}!`);
        }

        if (analysis.context) {
            const contextMap = {
                'personal trainer': 'personal trainers',
                'coach online': 'coaches online', 
                'iniciante': 'coaches que est√£o come√ßando',
                'experiente': 'coaches experientes'
            };
            
            const contextText = contextMap[analysis.context];
            if (contextText && !response.includes(contextText)) {
                response += `\n\nüí° Especialmente para ${contextText}, temos abordagens espec√≠ficas!`;
            }
        }

        return response;
    }

    applySentimentAdjustment(response, analysis) {
        switch (analysis.sentiment) {
            case 'positive':
                if (!response.includes('üéâ')) {
                    response = response.replace(/üí°/, 'üéâ');
                }
                break;
            case 'negative':
                response = response.replace(/üí°/, 'ü§î');
                // Adiciona garantia extra para obje√ß√µes
                if (!response.includes(this.knowledge.results.guarantee.type)) {
                    response += `\n\nüõ°Ô∏è Lembre-se: ${this.knowledge.results.guarantee.type} - ${this.knowledge.results.guarantee.terms}`;
                }
                break;
            case 'curious':
                response = response.replace(/üí°/, 'üîç');
                break;
        }
        return response;
    }

    applyUrgencyLayer(response, analysis) {
        if (analysis.urgency && !response.includes('üö®')) {
            const urgencyPhrase = `\n\n‚ö° VAGAS LIMITADAS: ${this.knowledge.pricing.vacancies.current} dispon√≠veis este m√™s!`;
            if (!response.includes('VAGAS LIMITADAS')) {
                response += urgencyPhrase;
            }
        }
        return response;
    }

    applyObjectionHandling(response, analysis) {
        if (analysis.objections.length > 0) {
            analysis.objections.forEach(objection => {
                if (!response.includes(this.getObjectionResponse(objection))) {
                    response += `\n\n${this.getObjectionResponse(objection)}`;
                }
            });
        }
        return response;
    }

    getObjectionResponse(objection) {
        const responses = {
            price: `üíé INVESTIMENTO VS RETORNO: Nosso ROI √© ${this.knowledge.results.metrics.roi}. Muitos coaches recuperam o investimento no primeiro m√™s!`,
            time: `‚è±Ô∏è TEMPO OTIMIZADO: Apenas 2-3 horas/semana para voc√™. N√≥s fazemos o trabalho pesado de marketing!`,
            efficacy: `üõ°Ô∏è GARANTIA: ${this.knowledge.results.guarantee.type} - ${this.knowledge.results.guarantee.terms}`,
            complexity: `üéØ SIMPLES NA PR√ÅTICA: N√≥s simplificamos tudo. Voc√™ grava, n√≥s fazemos o resto!`
        };
        return responses[objection] || '';
    }

    // ========================
    // FUN√á√ïES UTILIT√ÅRIAS
    // ========================
    randomChoice(array) {
        return array[Math.floor(Math.random() * array.length)];
    }

    getCustomApproach(context) {
        const approaches = {
            'personal trainer': 'conte√∫do presencial e transforma√ß√£o f√≠sica vis√≠vel',
            'coach online': 'autoridade digital e vendas remotas',
            'iniciante': 'constru√ß√£o de marca do zero com fundamentos s√≥lidos',
            'experiente': 'otimiza√ß√£o e escalabilidade para resultados maiores'
        };
        return approaches[context] || 'resultados comprovados para seu nicho';
    }

    getBudgetResponse(context) {
        const responses = {
            'or√ßamento limitado': 'temos op√ß√µes flex√≠veis e garantia de retorno',
            'investimento': 'focado em ROI r√°pido e comprovado',
            'valor': 'baseado no potencial de multiplica√ß√£o da sua receita'
        };
        return responses[context] || 'focado em maximizar seu retorno';
    }

    getFallbackResponse() {
        return `üîß Estou com dificuldade t√©cnica moment√¢nea. 

Por favor, entre em contato diretamente:
üì± WhatsApp: +351963828378
üìß Email: contato@fitgenious.com

Ou tente reformular sua pergunta! üí™`;
    }

    // ========================
    // M√âTODOS DE DIAGN√ìSTICO
    // ========================
    getAssistantInfo() {
        return {
            name: this.name,
            version: this.version,
            expertise: this.expertise,
            knowledgeBase: `${
                Object.keys(this.knowledge).length
            } categorias de conhecimento`,
            cases: this.knowledge.results.caseStudies.length
        };
    }

    testAnalysis(message) {
        return this.analyzeMessage(message);
    }
}

// Exporta√ß√£o para uso no servidor
export default FitGeniousAssistant;